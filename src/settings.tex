% \usepackage{calc} % <
% \usepackage[paper=b5j, headheight=10pt, footskip=0.03367\paperheight, headsep=\footskip-\topskip, includeheadfoot, vmargin=10truemm, hmargin=15truemm, includemp, nomarginpar]{geometry} % <
% \usepackage{etoolbox, expl3, xparse} % <
%%%%% ページレイアウト
\setpagelayout+{vmargin=10truemm, left=10truemm, right=7truemm, includemp, nomarginpar} % >



%%%%% フォント・文字
\setsansjfont[BoldFont=HaranoAjiGothic-Bold.otf]{HaranoAjiGothic-Medium.otf} % >
\setmonojfont[BoldFont=HaranoAjiGothic-Bold.otf]{HaranoAjiGothic-Medium.otf} % >
% \usepackage{mathtools}
% \PassOptionsToPackage{warnings-off={mathtools-colon,mathtools-overbracket}}{unicode-math}
\usepackage[olddefault, newcmbb, varnothing]{fontsetup}
\setmathfont[range={scr, bfscr}, StylisticSet=1]{NewCMMath-Regular.otf}
\DeclareMathAlphabet{\cl}{OMS}{cmsy}{m}{n} % 旧チャンセリー筆記体
\setsansfont{nimbussans}
\usepackage[old]{old-arrows}
\usepackage{longmath}
\usepackage{leftidx}
% \usepackage{fontsize} % <
% \newlength{\basefontsize} % <
% \setlength{\basefontsize}{8pt} % <
% \changefontsize[1.75\basefontsize]{\basefontsize} % <
\makeatletter
\AtBeginDocument{
  \catcode`_=12
  \begingroup\lccode`~=`_
  \lowercase{\endgroup\let~}\sb
  \mathcode`_="8000
  \immediate\write\@auxout{\catcode`_=12 }
}
\makeatother
\usepackage{newunicodechar}



%%%%% 見出し
\renewcommand{\headfont}{\bfseries}



%%%%% 色
\usepackage{xcolor}
\definecolor{mygreen}{HTML}{3a990f}
\definecolor{myblue}{HTML}{0f5599}
\definecolor{myred}{HTML}{990f1e}
% \definecolor{myyellow}{HTML}{b8ba05}
\definecolor{mygray}{HTML}{606060}
\definecolor{myurlcolor}{HTML}{ad0d00}
\definecolor{mylinkcolor}{HTML}{2a4f99}
\definecolor{mycitecolor}{HTML}{2a4f99}



%%%%% リスト
\usepackage[inline]{enumitem}
% \setlist{topsep=\baselinestretch}
% - - - - - - - - - -
\newlist{myenum}{enumerate}{1}
\setlist[myenum]{label=(\roman*), ref=(\roman*)}
\newlist{myenum*}{enumerate*}{1}
\setlist[myenum*]{label=(\roman*), ref=(\roman*)}
% - - - - - - - - - -
\newlist{thmlist}{enumerate}{3}
\setlist[thmlist, 1]{label=\arabic{thmlisti}., ref=\arabic{thmlisti}, noitemsep, leftmargin=*}
\setlist[thmlist, 2]{label=\arabic{thmlisti}.\arabic{thmlistii}., ref=\arabic{thmlisti}.\arabic{thmlistii}., noitemsep}
\setlist[thmlist, 3]{label=\arabic{thmlisti}.\arabic{thmlistii}.\arabic{thmlistiii}., ref=\arabic{thmlisti}.\arabic{thmlistii}.\arabic{thmlistiii}., noitemsep}
\makeatletter
\renewcommand{\p@thmlisti}{\perh@ps{\thetcbcounter.}}
\protected\def\perh@ps#1{#1}
\newcommand{\itemref}[1]{\begingroup\let\perh@ps\@gobble\ref{#1}\endgroup}
\makeatother
% - - - - - - - - - -
\newlist{step}{enumerate}{4}
\setlist[step, 1]{label=(\arabic{stepi}), ref=(\arabic{stepi}), noitemsep, leftmargin=*}
\setlist[step, 2]{label=(\arabic{stepi}.\arabic{stepii}), ref=(\arabic{stepi}.\arabic{stepii}), noitemsep, leftmargin=*}
\setlist[step, 3]{label=(\arabic{stepi}.\arabic{stepii}.\arabic{stepiii}), ref=(\arabic{stepi}.\arabic{stepii}.\arabic{stepiii}), noitemsep, leftmargin=*}
\setlist[step, 4]{label=(\arabic{stepi}.\arabic{stepii}.\arabic{stepiii}.\arabic{stepiv}), ref=(\arabic{stepi}.\arabic{stepii}.\arabic{stepiii}.\arabic{stepiv}), noitemsep, leftmargin=*}



%%%%% 定理環境その他
\makeatletter
\newcommand{\setlabelname}[1]{\protected@edef\@currentlabelname{#1}}
\makeatother
\ExplSyntaxOn
\NewDocumentCommand{ \Assume }{ m }{
  Assume:\ 
  \seq_set_split:Nnn \l_tmpa_seq { & } { #1 }
  \seq_use:Nn \l_tmpa_seq { \AND }
  \par
}
\NewDocumentCommand{ \See }{ m }{
  \par See:\ 
  \seq_set_split:Nnn \l_tmpa_seq { , } { #1 }
  \seq_set_map:NNn \l_tmpa_seq \l_tmpa_seq { \nameref{##1} }
  \seq_use:Nn \l_tmpa_seq { \AND }
}

\seq_new:N \g_my_labellist_seq
\NewDocumentCommand { \mylabel } { mO{} } {
  \tl_if_blank:nTF { #2 } {} { \setlabelname{#2} }
  \label{#1}
  \seq_gput_right:Nn \g_my_labellist_seq { #1 }
}
\NewDocumentCommand { \labellist } { m } {
  \tl_if_blank:nTF { #1 } {} {
    \hfill ---\ label:\ \texttt{#1}
  }
  \seq_if_empty:NTF \g_my_labellist_seq {} {
    \tl_if_blank:nTF { #1 } {} { \\ }
    \hfill ---\ label:\
    \seq_set_map:NNn \l_tmpa_seq \g_my_labellist_seq { \texttt{##1} }
    \seq_use:Nn \l_tmpa_seq { \\ \hfill }
  }
  \seq_gclear:N \g_my_labellist_seq
}
\ExplSyntaxOff

\newcommand{\Syn}[1]{Syn.\@ for #1 ---}

% \renewcommand{\See}[1]{}
% \renewcommand{\labellist}[1]{}



%%%%% 数式
\everymath{\displaystyle} % <
% \everymath=\expandafter{\the\everymath \narrowbaselines\displaystyle} % >
\usepackage{scalerel}



%%%%% ハイパーリンク
\usepackage{hyperref}
\hypersetup{setpagesize=false, bookmarksnumbered, colorlinks=true, linkcolor=mylinkcolor, citecolor=mycitecolor, urlcolor=myurlcolor, pdfauthor={鴎海}}



%%%%% cref
\usepackage[nameinlink]{cleveref}



%%%%% tcolorbox
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}
\NewTColorBox[auto counter, number within=chapter]{none}{}{}
\NewDocumentCommand{\defitem}{mmmO{}}{%
  \crefname{thmlist#1}{#2}{#2}
  % 1: label. 2: nameref. 3: subtitle.
  \NewTColorBox[use counter from=none, crefname={#2}{#2s}]{#1}{O{}O{}O{}}{%
    enhanced, breakable,
    boxrule=0pt, frame hidden,
    sharp corners=west,
    top=1pt, middle=1pt, bottom=1pt,
    colback=#3!10!white, skin=bicolor, colbacklower=white,
    coltitle=#3, fonttitle=\bfseries,
    borderline west={2pt}{0pt}{#3},
    attach boxed title to top left={xshift=-12pt},
    boxed title style={tile, size=minimal, colback=white, bottom=2pt, borderline south={.5pt}{0pt}{#3}},
    title={#2~\thetcbcounter\ifstrempty{##3}{}{\ ---\ ##3}},
    label={\ifstrempty{##1}{item_\thetcbcounter}{##1}},
    nameref={\ifstrempty{##2}{##3}{##2}},
    before upper={\crefalias{thmlisti}{thmlist#1}},
    after upper={\footnotesize\labellist{##1}},
    before lower={\ifstrempty{#4}{}{\textbf{#4:}\hspace{1em}}},%
  }%
}
\defitem{dfn}{Definition}{myblue}[Example]
\defitem{lem}{Lemma}{mygreen}[Proof]
\defitem{prp}{Proposition}{mygreen}[Proof]
\defitem{thm}{Theorem}{mygreen}[Proof]
\defitem{axm}{Axiom}{myred}
\defitem{cnv}{Convention}{mygray}

\newtcolorbox{nb}{%
  enhanced, breakable,
  right*=0pt, top=0pt, bottom=0pt,
  tile,
  sharp corners=west,
  borderline west={2pt}{0pt}{dashed},
}
